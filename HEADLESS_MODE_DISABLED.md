# Puppeteer 无头模式已关闭

## ✅ 修改内容

### 修改前
```javascript
headless: puppeteerConfig.headless !== false,  // 默认无头模式
```

### 修改后
```javascript
headless: false,  // ✅ 关闭无头模式，显示浏览器窗口
```

## 🎯 效果

### 之前（无头模式）
- 看不到浏览器窗口
- 无法观察抓取过程
- 调试困难

### 现在（可见模式）
- ✅ **可以看到浏览器窗口**
- ✅ **可以观察页面加载过程**
- ✅ **可以看到视频元素**
- ✅ **可以手动检查页面**
- ✅ **调试非常方便**

## 📊 运行效果

启动 Electron 后，抓取视频时会：

1. **弹出 Chrome 浏览器窗口** （Puppeteer控制的）
2. 自动访问抖音首页
3. 自动访问目标视频页面
4. 等待3秒加载
5. 提取视频信息
6. 关闭浏览器窗口

**你可以全程看到整个过程！** 👀

## 🔍 调试优势

### 1. 查看页面结构

你可以直接在浏览器窗口中：
- 右键 → 检查元素
- 查看 `<video>` 元素
- 查看 `<source>` 子元素
- 验证提取逻辑是否正确

### 2. 手动验证

浏览器窗口打开时，你可以：
- 暂停代码执行（添加断点）
- 手动在控制台运行代码
- 检查页面是否完全加载
- 查看是否有反爬虫拦截

### 3. 截图保存

可以看到实际访问的页面，方便截图保存问题现场。

## ⚠️ 注意事项

### 1. 不要手动操作浏览器

Puppeteer 启动的浏览器窗口是**自动控制**的：
- ❌ 不要手动点击
- ❌ 不要手动输入
- ❌ 不要手动关闭
- ✅ 只是观察，不要干预

### 2. 多个窗口

如果同时抓取多个视频，会打开多个浏览器窗口，这是正常的。

### 3. 自动关闭

抓取完成后，浏览器窗口会自动关闭。

### 4. 性能影响

可见模式比无头模式：
- 稍微慢一点（渲染UI）
- 占用更多内存
- 但对调试非常有帮助

## 🎓 调试技巧

### 查看视频元素

当浏览器窗口打开时：

1. 按 `F12` 打开开发者工具
2. 切换到 `Elements` 标签
3. 查找 `<video>` 元素
4. 展开查看 `<source>` 子元素
5. 检查最后一个 `<source>` 的 `src` 属性

### 在控制台测试

```javascript
// 在浏览器控制台运行
const video = document.querySelector('video');
const sources = video.querySelectorAll('source');
console.log('Source count:', sources.length);
sources.forEach((s, i) => {
  console.log(`Source ${i}:`, s.src);
});
```

### 检查页面加载

观察页面是否：
- 完全加载
- 视频是否出现
- 是否被反爬虫拦截
- 是否需要登录

## 🔄 切换回无头模式

调试完成后，可以重新启用无头模式：

```javascript
// puppeteerService.js 第34行
headless: true,  // 重新启用无头模式
```

或者使用配置：
```javascript
headless: puppeteerConfig.headless !== false,
```

## 📝 配置文件控制

也可以在配置文件中控制（如果需要）：

```javascript
// config.js
const defaultConfig = {
  puppeteer: {
    headless: false,  // 在配置中控制
    // ...
  }
};
```

## 🎉 立即测试

1. **重启 Electron**
   ```bash
   cd pangu-electron
   restart-electron.bat
   ```

2. **抓取视频**
   - 输入视频链接
   - 观察浏览器窗口弹出
   - 观察页面加载过程
   - 查看控制台日志

3. **检查结果**
   - 日志应该显示英文（不再乱码）
   - 可以看到浏览器操作过程
   - 可以发现视频提取失败的原因

## 📊 常见问题定位

### 问题：没有 source 子元素

**观察浏览器窗口**：
- 视频是否出现？
- video 元素结构是什么样？
- 是否使用了其他方式加载视频？

**解决方案**：
- 增加等待时间
- 使用 video.src 作为备用方案（已实现）
- 检查页面是否需要交互（如点击播放）

### 问题：source 是 blob URL

**观察**：
- source.src 的值是什么？
- 是否是 `blob:...` 开头？

**解决方案**：
- 等待更长时间让真实URL加载
- 使用其他提取方法

## 🎁 额外好处

关闭无头模式还能：
- 学习抖音页面结构
- 理解视频加载机制
- 发现反爬虫策略
- 优化提取逻辑

---

## 📅 更新日志

### 2025-11-06
- ✅ 关闭 Puppeteer 无头模式
- ✅ 所有日志改为英文（避免乱码）
- ✅ 优化视频提取逻辑
- ✅ 添加备用提取方案（video.src）

---

**现在重启 Electron，你可以看到浏览器窗口了！** 🎉

