# OSS è§†é¢‘å°é¢åŠŸèƒ½ä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

ä½¿ç”¨é˜¿é‡Œäº‘ OSS çš„è§†é¢‘æˆªå¸§åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆè§†é¢‘ç¼©ç•¥å›¾ï¼Œæ— éœ€æ‰‹åŠ¨æå–æˆ–ä¸Šä¼ å°é¢å›¾ã€‚

**å®˜æ–¹æ–‡æ¡£**: https://help.aliyun.com/zh/oss/user-guide/video-snapshots

## âœ… å®ç°æ–¹æ¡ˆ

### ç¼©ç•¥å›¾ URL ç”Ÿæˆ

```javascript
const generateOssThumbnail = (videoUrl) => {
  if (!videoUrl) return '';
  
  // æ·»åŠ  OSS è§†é¢‘æˆªå¸§å‚æ•°
  return `${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_0,h_0,m_fast`;
};

// ç¤ºä¾‹
è§†é¢‘URL: https://pangu-ai-agent.oss-cn-beijing.aliyuncs.com/videos/xxx.mp4
ç¼©ç•¥å›¾: https://pangu-ai-agent.oss-cn-beijing.aliyuncs.com/videos/xxx.mp4?x-oss-process=video/snapshot,t_1000,f_jpg,w_0,h_0,m_fast
```

### å‚æ•°è¯´æ˜

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| `t` | 1000 | æˆªå–æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ1000ms = ç¬¬1ç§’ |
| `f` | jpg | è¾“å‡ºæ ¼å¼ï¼ˆjpg/png/webpï¼‰ |
| `w` | 0 | å®½åº¦ï¼ˆ0=ä¿æŒåŸå§‹ï¼‰ |
| `h` | 0 | é«˜åº¦ï¼ˆ0=ä¿æŒåŸå§‹ï¼‰ |
| `m` | fast | æ¨¡å¼ï¼ˆfast=å¿«é€Ÿæ¨¡å¼ï¼‰ |

## ğŸ“Š å·¥ä½œæµç¨‹

```
ä¸Šä¼ è§†é¢‘åˆ° OSS
    â†“
videoUrl = "https://pangu-ai-agent.oss-cn-beijing.aliyuncs.com/videos/xxx.mp4"
    â†“
ç”Ÿæˆç¼©ç•¥å›¾ URL
    â†“
thumbnailUrl = videoUrl + "?x-oss-process=video/snapshot,t_1000,f_jpg,w_0,h_0,m_fast"
    â†“
è¿”å›ç»™å‰ç«¯
    â†“
<VideoCard thumbnail={thumbnailUrl} />
    â†“
æµè§ˆå™¨è®¿é—®ç¼©ç•¥å›¾ URL
    â†“
OSS å®æ—¶ç”Ÿæˆå¹¶è¿”å› JPG å›¾ç‰‡ âœ…
```

## ğŸ¨ ä¼˜åŠ¿

### âœ… ç›¸æ¯”é¡µé¢æå–å°é¢å›¾

1. **æ›´å¯é **: ä¸ä¾èµ–é¡µé¢ç»“æ„
2. **æ›´ç®€å•**: åªéœ€æ·»åŠ  URL å‚æ•°
3. **æ›´ç»Ÿä¸€**: æ‰€æœ‰è§†é¢‘éƒ½æœ‰ç¼©ç•¥å›¾
4. **æ›´å¿«é€Ÿ**: æ— éœ€é¢å¤–å¤„ç†
5. **æ— è·¨åŸŸé—®é¢˜**: ç¼©ç•¥å›¾å’Œè§†é¢‘åŒåŸŸ

### âœ… ç›¸æ¯”æ‰‹åŠ¨ç”Ÿæˆç¼©ç•¥å›¾

1. **é›¶æˆæœ¬**: æ— éœ€ ffmpeg æˆ–å…¶ä»–å·¥å…·
2. **å®æ—¶ç”Ÿæˆ**: OSS è‡ªåŠ¨å¤„ç†
3. **æ— å­˜å‚¨æˆæœ¬**: ä¸éœ€è¦å•ç‹¬å­˜å‚¨ç¼©ç•¥å›¾
4. **å¯å®šåˆ¶**: é€šè¿‡å‚æ•°è°ƒæ•´æ—¶é—´ç‚¹ã€å°ºå¯¸ç­‰

## ğŸ”§ è‡ªå®šä¹‰å‚æ•°

### æˆªå–ä¸åŒæ—¶é—´ç‚¹

```javascript
// æˆªå–ç¬¬1ç§’
t_1000

// æˆªå–ç¬¬3ç§’
t_3000

// æˆªå–ç¬¬5ç§’
t_5000
```

### æŒ‡å®šç¼©ç•¥å›¾å°ºå¯¸

```javascript
// ä¿æŒåŸå§‹å°ºå¯¸
w_0,h_0

// å®½åº¦800pxï¼Œé«˜åº¦è‡ªé€‚åº”
w_800,h_0

// å®½åº¦800pxï¼Œé«˜åº¦600px
w_800,h_600

// å®½åº¦320pxï¼ˆé€‚åˆåˆ—è¡¨ï¼‰
w_320,h_0
```

### è¾“å‡ºæ ¼å¼

```javascript
// JPGæ ¼å¼ï¼ˆé»˜è®¤ï¼Œæ–‡ä»¶å°ï¼‰
f_jpg

// PNGæ ¼å¼ï¼ˆè´¨é‡é«˜ï¼‰
f_png

// WebPæ ¼å¼ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
f_webp
```

### å®Œæ•´ç¤ºä¾‹

```javascript
// é«˜è´¨é‡å¤§å›¾ï¼ˆæ’­æ”¾é¡µï¼‰
`${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_1920,h_1080`

// ä¸­ç­‰ç¼©ç•¥å›¾ï¼ˆå¡ç‰‡ï¼‰
`${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_800,h_0,m_fast`

// å°ç¼©ç•¥å›¾ï¼ˆåˆ—è¡¨ï¼‰
`${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_320,h_0,m_fast`
```

## ğŸ“ ä»£ç ä½ç½®

**æ–‡ä»¶**: `pangu-electron/electron/services/puppeteerService.js`

**ä½ç½®**: ç¬¬ 309-336 è¡Œ (fetchDouyin æ–¹æ³•)

**å…³é”®ä»£ç **:
```javascript
const generateOssThumbnail = (videoUrl) => {
  if (!videoUrl) return '';
  return `${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_0,h_0,m_fast`;
};

const finalResult = {
  thumbnailUrl: generateOssThumbnail(ossVideoUrl),
  ...
};
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. é‡å¯ Electron

```bash
taskkill /F /IM electron.exe
cd pangu-electron
start-utf8.bat
```

### 2. æŠ“å–è§†é¢‘

### 3. æŸ¥çœ‹æ—¥å¿—

**é¢„æœŸè¾“å‡º**:
```
Final thumbnailUrl (OSS snapshot): https://pangu-ai-agent.oss-cn-beijing.aliyuncs.com/videos/xxx.mp4?x-oss-process=video/snapshot,t_1000,f_jpg,w_0,h_0,m_fast
```

### 4. éªŒè¯ç¼©ç•¥å›¾

åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®ç¼©ç•¥å›¾ URLï¼Œåº”è¯¥è¿”å›ä¸€å¼  JPG å›¾ç‰‡ï¼ˆè§†é¢‘ç¬¬1ç§’çš„æˆªå›¾ï¼‰ã€‚

### 5. æŸ¥çœ‹è§†é¢‘å¡ç‰‡

è§†é¢‘å¡ç‰‡åº”è¯¥æ˜¾ç¤ºç¼©ç•¥å›¾å°é¢ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. OSS éœ€è¦å¼€å¯å›¾ç‰‡å¤„ç†åŠŸèƒ½

ç¡®ä¿ä½ çš„ OSS Bucket å·²å¼€å¯å›¾ç‰‡å¤„ç†åŠŸèƒ½ï¼ˆé»˜è®¤å¼€å¯ï¼‰ã€‚

### 2. è§†é¢‘æ ¼å¼æ”¯æŒ

æ”¯æŒçš„è§†é¢‘æ ¼å¼ï¼š
- âœ… MP4
- âœ… AVI
- âœ… FLV
- âœ… MKV
- âœ… MOV
- âœ… WebM

### 3. è§†é¢‘æ—¶é•¿è¦æ±‚

- æˆªå–æ—¶é—´ä¸èƒ½è¶…è¿‡è§†é¢‘æ€»æ—¶é•¿
- å¦‚æœè§†é¢‘å°äº1ç§’ï¼Œæˆªå–ä¼šå¤±è´¥
- å»ºè®®ä½¿ç”¨ `t_1000`ï¼ˆç¬¬1ç§’ï¼‰æ¯”è¾ƒå®‰å…¨

### 4. æ€§èƒ½è€ƒè™‘

- OSS é¦–æ¬¡ç”Ÿæˆç¼©ç•¥å›¾éœ€è¦ä¸€å®šæ—¶é—´ï¼ˆ1-3ç§’ï¼‰
- ç”Ÿæˆåä¼šç¼“å­˜ï¼Œå†æ¬¡è®¿é—®å¾ˆå¿«
- å»ºè®®ä½¿ç”¨ `m_fast` å¿«é€Ÿæ¨¡å¼

## ğŸ¨ é«˜çº§ç”¨æ³•

### ç”Ÿæˆå¤šç§å°ºå¯¸çš„ç¼©ç•¥å›¾

```javascript
const thumbnails = {
  large: `${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_1920,h_1080`,
  medium: `${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_800,h_0`,
  small: `${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg,w_320,h_0`,
};
```

### æˆªå–å¤šä¸ªæ—¶é—´ç‚¹

```javascript
// å°é¢ï¼šç¬¬1ç§’
const cover = `${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg`;

// é¢„è§ˆå›¾ï¼šç¬¬5ç§’
const preview1 = `${videoUrl}?x-oss-process=video/snapshot,t_5000,f_jpg`;

// é¢„è§ˆå›¾ï¼šç¬¬10ç§’
const preview2 = `${videoUrl}?x-oss-process=video/snapshot,t_10000,f_jpg`;
```

### æ·»åŠ æ°´å°ï¼ˆå¯é€‰ï¼‰

å¯ä»¥ç»“åˆ OSS å›¾ç‰‡å¤„ç†æ·»åŠ æ°´å°ï¼š
```javascript
`${videoUrl}?x-oss-process=video/snapshot,t_1000,f_jpg|image/watermark,text_UGFuZ3U,size_20`
```

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1: ç¼©ç•¥å›¾æ˜¾ç¤º 403 Forbidden

**åŸå› **: è§†é¢‘æ–‡ä»¶æ²¡æœ‰å…¬å…±è¯»æƒé™

**è§£å†³**: ç¡®ä¿ä¸Šä¼ æ—¶è®¾ç½®äº†å…¬å…±è¯»æƒé™
```java
ossClient.setObjectAcl(bucket, objectKey, CannedAccessControlList.PublicRead);
```

### é—®é¢˜ 2: ç¼©ç•¥å›¾åŠ è½½å¤±è´¥

**æ£€æŸ¥**:
1. ç›´æ¥åœ¨æµè§ˆå™¨è®¿é—®ç¼©ç•¥å›¾ URL
2. æŸ¥çœ‹è¿”å›çš„å†…å®¹
3. æ˜¯å¦æ˜¯å›¾ç‰‡æ ¼å¼

**å¯èƒ½åŸå› **:
- è§†é¢‘æ ¼å¼ä¸æ”¯æŒ
- æˆªå–æ—¶é—´è¶…è¿‡è§†é¢‘æ—¶é•¿
- OSS åŒºåŸŸä¸æ”¯æŒè§†é¢‘å¤„ç†

### é—®é¢˜ 3: ç¼©ç•¥å›¾è´¨é‡ä¸å¥½

**ä¼˜åŒ–å‚æ•°**:
```javascript
// ä½¿ç”¨æ›´é«˜çš„è´¨é‡
t_1000,f_jpg,w_1920,h_1080,m_fast

// æˆªå–æ›´å¥½çš„æ—¶é—´ç‚¹ï¼ˆå¦‚ç¬¬3ç§’ï¼‰
t_3000,f_jpg,w_800,h_0,m_fast
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ–¹æ¡ˆ | ç”Ÿæˆæ—¶é—´ | å­˜å‚¨æˆæœ¬ | ç»´æŠ¤æˆæœ¬ | å¯é æ€§ |
|------|---------|---------|---------|--------|
| é¡µé¢æå– | å³æ—¶ | æ—  | é«˜ï¼ˆé¡µé¢æ”¹ç‰ˆï¼‰ | ä½ |
| ffmpegç”Ÿæˆ | 5-10ç§’ | é«˜ | ä¸­ | é«˜ |
| OSSæˆªå¸§ | 1-3ç§’ | æ—  | ä½ | é«˜ âœ… |
| Canvasç”Ÿæˆ | 1-2ç§’ | æ—  | ä¸­ | ä¸­ |

**OSS æˆªå¸§æ–¹æ¡ˆç»¼åˆè¡¨ç°æœ€ä½³ï¼** â­

## ğŸ‰ æ€»ç»“

### ä¼˜ç‚¹
- âœ… é›¶æˆæœ¬ï¼ˆä¸éœ€è¦å­˜å‚¨ï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆï¼ˆOSSå¤„ç†ï¼‰
- âœ… ç®€å•å¯é ï¼ˆåªéœ€URLå‚æ•°ï¼‰
- âœ… çµæ´»å®šåˆ¶ï¼ˆæ”¯æŒå¤šç§å‚æ•°ï¼‰
- âœ… æ— è·¨åŸŸé—®é¢˜ï¼ˆåŒåŸŸåï¼‰

### ä½¿ç”¨åœºæ™¯
- âœ… è§†é¢‘é¢„è§ˆå¡ç‰‡
- âœ… è§†é¢‘åˆ—è¡¨
- âœ… è§†é¢‘è¯¦æƒ…é¡µ
- âœ… åˆ†äº«å¡ç‰‡

---

**ç«‹å³é‡å¯æµ‹è¯•ï¼Œç°åœ¨è§†é¢‘å¡ç‰‡åº”è¯¥æœ‰æ¼‚äº®çš„å°é¢å›¾äº†ï¼** ğŸ–¼ï¸âœ¨

## ğŸ“… æ›´æ–°æ—¥å¿—

### 2025-11-06
- âœ… å›æ»šé¡µé¢æå–å°é¢å›¾æ–¹æ¡ˆ
- âœ… å®ç° OSS è§†é¢‘æˆªå¸§åŠŸèƒ½
- âœ… ä½¿ç”¨ URL å‚æ•°ç”Ÿæˆç¼©ç•¥å›¾
- âœ… é›¶å­˜å‚¨æˆæœ¬ã€è‡ªåŠ¨ç”Ÿæˆ

